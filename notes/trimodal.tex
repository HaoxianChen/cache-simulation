\documentclass[12pt, letterpaper]{article}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{soul}
\usepackage{float}
\usepackage{graphicx}
\graphicspath{ {../graphs/} }


\title{Trimodal analysis}
\author{Brandon Chen}

\begin{document}
\maketitle
\section{Trimodal}

Trimodal: application scans three arrays simultaneously.

\begin{itemize}
\item $x_1$: size of array 1
\item $x_2$: size of array 2
\item $x_3$: size of array 3
\item $p_1$: probability of access array 1
\item $p_2$: probability of access array 2
\item $p_3$: probability of access array 3
\item $d_1 = \frac{x_1}{p_1}$: reuse distance for data in array 1
\item $d_2 = \frac{x_2}{p_2}$: reuse distance for data in array 2
\item $d_3 = \frac{x_3}{p_3}$: reuse distance for data in array 3
\item $ed = p d_1 + p_2 d_2 + p_3 d_3 $: expected reuse distance, equals the
size of working set 
\item S: cache size
\item m: miss rate
\end{itemize}

The relation between cache size and miss rate:
\begin{equation}
S = \sum a [H(a) + E(a)]
\end{equation}

\subsection{evict at 0 (MRU)}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{mru_value}
\caption{policy: mru}
\end{figure}

\begin{equation}
\begin{aligned}
m = 1 - \frac{S}{ed}
\end{aligned}
\end{equation}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{sim_mru}
\caption{simulation result}
\end{figure}

\subsection{evict at d1}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{evict_d1}
\caption{policy: evict candidate at age d1}
\end{figure}

\[
m = \left\{\begin{array}{lr}
      1-p_1 \frac{S}{d_1}, & \text{for } 0 \leq S \leq d_1 \\
      (1-p_1) \frac{ed-S}{ed-d_1}, & \text{for } d_1 \leq S \leq ed
           \end{array}
\]


\subsection{evict at d2, then 0}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{evict_d2.png}
\caption{replacement policy in value function}
\end{figure}

Let x denote fraction of candidates who make it to the age of d1.

\subsection{Cache behaviors with size between d1 and d2}

\subsubsection{evict at d1}
\label{sec:policyd1}


\begin{center}
\begin{tabular}{c | c c c c}
\hline
events & 1 & d1 & d2 & d3 \\
\hline
hit & & p1 & $p_2 (1-\frac{m}{1-p_1}) $ & $p_3(1-\frac{m}{1-p_1}) $ \\
evict & & m & & \\
\hline
\end{tabular}
\end{center}

\begin{equation}
\begin{aligned}
m = \frac{ed-S}{\frac{p_2}{1-p_1} d_2 + \frac{p_3}{1-p_1} d_3 - d_1}
= (1-p_1) \frac{ed-S}{ed-d_1}
\end{aligned}
\end{equation}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{sim_d1.png}
\caption{simulation result}
\end{figure}

\subsubsection{evict at d2, then 0}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{evict_d2.png}
\caption{replacement policy in value function}
\end{figure}

Let x denote fraction of candidates who make it to the age of d1.

\begin{center}
\begin{tabular}{c | c c c c}
\hline
events & 1 & d1 & d2 & d3 \\
\hline
hit & & $p_1 x$ & $p_2 x$ &  \\
evict & 1-x & & $p_3 x$ & 
\end{tabular}
\end{center}

\begin{equation}
\begin{aligned}
m = 1 - (1-p_3) \frac{S}{p_1 d_1 + p_2 d_2 + p_3 d_2}
\end{aligned}
\end{equation}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{sim_d2.png}
\caption{simulation result}
\end{figure}

\subsubsection{evict at d2, d1, then 0}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{evict_d2_d1.png}
\caption{replacement policy graph}
\end{figure}

Let x denote fraction of candidates who make it to the age of d1.

\begin{center}
\begin{tabular}{c | c c c c}
\hline
events & 1 & d1 & d2 & d3 \\
\hline
hit & & $p_1 x$ & $p_2 x$ &  \\
evict & & 1-x & $p_3 x$ & 
\end{tabular}
\end{center}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{sim_d2_d1.png}
\caption{simulation result}
\end{figure}

\subsubsection{evict at d1, d2, then 0}

Just behave identical to policy~\ref{sec:policyd1}.

\subsection{Cache behaviors larger then d2}

\subsubsection{evict at d1, then 0}

\begin{center}
\begin{tabular}{c | c c c c}
\hline
events & 0 & d1 & d2 & d3 \\
\hline
hit & & $p_1$& $p_2$ & $p_3-m$ \\
evict & & m &  & 
\end{tabular}
\end{center}

\begin{equation}
\begin{aligned}
m  = (1-p_1) \frac{ed - S}{ed - d_1}
\end{aligned}
\end{equation}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{sim_d1_3.png}
\caption{simulation result}
\end{figure}

\subsubsection{evict at d2, then 0}

\begin{center}
\begin{tabular}{c | c c c c}
\hline
events & 0 & d1 & d2 & d3 \\
\hline
hit & & $p_1$& $p_2$ & $p_3-m$ \\
evict & &  & m & 
\end{tabular}
\end{center}

\begin{equation}
\begin{aligned}
m  = \frac{ed - S}{d_3 - d_2}
\end{aligned}
\end{equation}

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{sim_d2_3.png}
\caption{simulation result}
\end{figure}

\section{Solving MDP with analytical approach}

when $0<a<d_1$:
\begin{equation}
\begin{aligned}
v[a]-v[0] = [(a-1)(1-m)+1][v[1]-v[0]]
\end{aligned}
\end{equation}

when $a=d_1+1$:
\begin{equation}
\begin{aligned}
v[d_1+1]-v[0] = \frac{d_1 (1-m)+1}{1-P_{H}(d_1)}(v[1]-v[0]) - \frac{P_{H}(1-d_1)}{1-P_{H}(d_1)}
\end{aligned}
\end{equation}

% \include{lessons}

\end{document}
